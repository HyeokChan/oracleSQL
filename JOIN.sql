-- 조인
-- INNER JOIN : 양쪽 테이블에 모두 내용이 있는 것만 조인되는 방식
SELECT * FROM BUYTBL;
SELECT * FROM USERTBL;
SELECT BUYTBL.USERID, USERTBL.USERNAME, BUYTBL.PRODNAME, USERTBL.ADDR, USERTBL.MOBILE1||USERTBL.MOBILE2 AS "연락처" FROM BUYTBL
    INNER JOIN USERTBL
    ON BUYTBL.USERID = USERTBL.USERID
    WHERE BUYTBL.USERID = 'JYP';
    
SELECT B.USERID, U.USERNAME, B.PRODNAME, U.ADDR, U.MOBILE1||U.MOBILE2 AS "연락처" FROM BUYTBL B -- 별칭으로 코드 간결화
    INNER JOIN USERTBL U
    ON B.USERID = U.USERID 
    WHERE B.USERID = 'JYP';

SELECT DISTINCT U.USERID, U.USERNAME, U.ADDR FROM USERTBL U -- 물건을 한번이라도 구매한 적있는 사용자 정보 (DISTINCT)
    INNER JOIN BUYTBL B
    ON U.USERID = B.USERID;
    
SELECT U.USERID, U.USERNAME, U.ADDR FROM USERTBL U -- 물건을 한번이라도 구매한 적있는 사용자 정보 (EXITS, SUBQUERY)
    WHERE EXISTS(SELECT * FROM BUYTBL B WHERE U.USERID = B.USERID);
    
-- 3테이블 조인 (다대다 관계 해소)
CREATE TABLE STDTBL(
    STDNAME NCHAR(5) NOT NULL PRIMARY KEY,
    ADDR    NCHAR(2) NOT NULL
);
CREATE TABLE CLUBTBL(
    CLUBNAME    NCHAR(5) NOT NULL PRIMARY KEY,
    ROOMNO      NCHAR(4) NOT NULL
);
CREATE SEQUENCE STDCLUBSEQ;
CREATE TABLE STDCLUBTBL(    -- 외래키 생성
    IDNUM       NUMBER(5) NOT NULL PRIMARY KEY,
    STDNAME     NCHAR(5) NOT NULL,
    CLUBNAME    NCHAR(5) NOT NULL,
    FOREIGN KEY(STDNAME) REFERENCES STDTBL(STDNAME),
    FOREIGN KEY(CLUBNAME) REFERENCES CLUBTBL(CLUBNAME)
);
INSERT INTO stdTBL VALUES('김범수','경남');
INSERT INTO stdTBL VALUES('성시경','서울');
INSERT INTO stdTBL VALUES('조용필','경기');
INSERT INTO stdTBL VALUES('은지원','경북');
INSERT INTO stdTBL VALUES('바비킴','서울');
INSERT INTO clubTBL VALUES('수영','101호');
INSERT INTO clubTBL VALUES('바둑','102호');
INSERT INTO clubTBL VALUES('축구','103호');
INSERT INTO clubTBL VALUES('봉사','104호');
INSERT INTO stdclubTBL VALUES(stdclubSEQ.NEXTVAL, '김범수','바둑');
INSERT INTO stdclubTBL VALUES(stdclubSEQ.NEXTVAL,'김범수','축구');
INSERT INTO stdclubTBL VALUES(stdclubSEQ.NEXTVAL,'조용필','축구');
INSERT INTO stdclubTBL VALUES(stdclubSEQ.NEXTVAL,'은지원','축구');
INSERT INTO stdclubTBL VALUES(stdclubSEQ.NEXTVAL,'은지원','봉사');
INSERT INTO stdclubTBL VALUES(stdclubSEQ.NEXTVAL,'바비킴','봉사');

SELECT * FROM STDTBL;
SELECT * FROM CLUBTBL;
SELECT * FROM STDCLUBTBL;

SELECT S.STDNAME, S.ADDR, C.CLUBNAME, C.ROOMNO FROM STDTBL S
    INNER JOIN STDCLUBTBL SC
    ON S.STDNAME = SC.STDNAME
    INNER JOIN CLUBTBL C
    ON SC.CLUBNAME = C.CLUBNAME
    ORDER BY S.STDNAME;
    
SELECT C.CLUBNAME, C.ROOMNO, S.STDNAME, S.ADDR FROM CLUBTBL C
    INNER JOIN STDCLUBTBL SC
    ON C.CLUBNAME = SC.CLUBNAME
    INNER JOIN STDTBL S
    ON SC.STDNAME = S.STDNAME
    ORDER BY CLUBNAME;
    
    
    

    
    
